---
layout:     post
title:     水塘抽样问题
date:      2018-03-07
category:  特色算法
tags:      [特色算法] 
---

### [水塘抽样问题](https://www.cnblogs.com/strugglion/p/6424874.html)

**可否在一未知大小的集合中，随机取出一元素？**

水塘抽样是一种随机算法，其目的在于从包含n个项目的集合S中选取k个样本，其中n为一很大或未知的数量，尤其适用于不能把所有n个项目都存放到主内存的情况。

##### k=1的情形

给定一个长度很大或者长度未知数据流，限定对每个元素只能访问一次，写出一个随机选择算法，使得所有元素被选中的概率相等。

对于数据流扫描一遍，假设当前扫描的是第n个

- n=1时，直接返回，概率为1
- n=2时，生成0-2随机数，如果>1则选择2，否则选择1。概率都是1/2
- n=3时，生成0-3随机数，如果>2则选择3，因此3被选中概率为1/3，前面的1和2被选中的概率为（1-1/3）* 1/2=1/3
- n=m时，生成0-m的随机数，m被选中概率为1/m，前面的m-1个数被选中概率为（1-1/m）*1/(m-1)=1/m

##### k>1的情形

k为任意整数的情况，即要求最终返回的元素有k个，这就是水塘抽样（Reservoir Sampling）问题。要求是：取到第n个元素时，前n个元素被留下的几率相等，即k/n。

- 初始化，对于前k个元素，一定选中
- 当n>k时，生成0-n的随机数，如果>n-k，那么选择第n个元素，第n个元素的概率是k/n，前面元素被抛弃的条件是选到了第n个元素(概率1/k)，并且从前面k个元素中选择一个淘汰掉，因此k个元素淘汰一个的概率是1/k*k/n就是1/n，因此选中的概率是k/(n-1)*\*(1-1/n) = k/n



####  例题

[Leetcode 382](https://leetcode.com/problems/linked-list-random-node/description/)




